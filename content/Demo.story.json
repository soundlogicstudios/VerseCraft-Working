{
  "schemaVersion": 1,
  "meta": {
    "id": "demo-systems-lab",
    "title": "Systems Lab Demo",
    "author": "VerseCraft",
    "version": "1.1.0"
  },

  "equipmentLabels": {
    "weapon": "Tool",
    "armor": "Outfit",
    "special": "Keepsake",
    "items": "Gear",
    "consumables": "Supplies",
    "resources": "Vitals"
  },

  "resources": {
    "HP": { "label": "Hit Points", "current": 20, "max": 20 },
    "CREDITS": { "label": "Credits", "current": 10, "max": 999 }
  },

  "items": {
    "STETHOSCOPE": {
      "name": "Stethoscope",
      "allowedSlots": ["weapon"],
      "onEquip": [
        { "op": "statAdd", "key": "WISDOM", "value": 1 }
      ]
    },
    "SCRUBS": {
      "name": "Scrubs",
      "allowedSlots": ["armor"],
      "onEquip": [
        { "op": "statAdd", "key": "ENDURANCE", "value": 1 },
        { "op": "resourceMaxAdd", "key": "HP", "value": 5 },
        { "op": "resourceAdd", "key": "HP", "value": 5 }
      ],
      "onUnequip": [
        { "op": "resourceMaxAdd", "key": "HP", "value": -5 },
        { "op": "resourceSet", "key": "HP", "value": 15 }
      ]
    },
    "LOCKET": {
      "name": "Locket",
      "allowedSlots": ["special"],
      "onEquip": [
        { "op": "statAdd", "key": "LUCK", "value": 1 }
      ]
    }
  },

  "loadout": {
    "equip": {
      "weapon": "STETHOSCOPE",
      "armor": "SCRUBS"
    },
    "items": ["LOCKET"],
    "consumables": ["MEDKIT"]
  },

  "start": "N1",

  "nodes": {
    "N1": {
      "text": "SYSTEMS LAB DEMO\n\nThis story exists to test VerseCraft mechanics in a controlled environment.\n\nOpen Inventory now:\n- You should start with Tool/Outfit equipped.\n- You should have a Keepsake in Gear.\n- You should have 1 Medkit.\n- HP and Credits should display under Vitals.\n\nReady to run the lab route?",
      "choices": [
        { "text": "Enter the Lab Corridor", "to": "N2" },
        { "text": "Visit the Supply Kiosk", "to": "N5" }
      ]
    },

    "N2": {
      "text": "You step into the corridor. A warning light strobes.\n\nA loose panel snaps open and clips you hard.\n\n(You take 6 damage.)",
      "choices": [
        {
          "text": "Stagger forward",
          "to": "N3",
          "effects": [
            { "op": "resourceAdd", "key": "HP", "value": -6 }
          ]
        }
      ]
    },

    "N3": {
      "text": "You steady your breathing.\n\nIf your HP is low, this is where you should test using a consumable.",
      "choices": [
        {
          "text": "Use a Medkit (+8 HP)",
          "to": "N4",
          "require": { "hasConsumable": ["MEDKIT"] },
          "effects": [
            { "op": "consumeConsumable", "id": "MEDKIT" },
            { "op": "resourceAdd", "key": "HP", "value": 8 }
          ]
        },
        {
          "text": "Save the Medkit and continue",
          "to": "N4"
        },
        {
          "text": "If HP is 0, collapse",
          "to": "END_FAIL",
          "require": { "resourceLte": { "HP": 0 } }
        }
      ]
    },

    "N4": {
      "text": "At the end of the corridor, a test console waits.\n\nYou can earn Credits here, then spend them at the kiosk.\n\n(Choose one training task.)",
      "choices": [
        {
          "text": "Run a diagnostic (+10 Credits, -2 HP)",
          "to": "N6",
          "effects": [
            { "op": "resourceAdd", "key": "CREDITS", "value": 10 },
            { "op": "resourceAdd", "key": "HP", "value": -2 }
          ]
        },
        {
          "text": "Do careful calibration (+6 Credits)",
          "to": "N6",
          "effects": [
            { "op": "resourceAdd", "key": "CREDITS", "value": 6 }
          ]
        },
        {
          "text": "Back to the kiosk",
          "to": "N5"
        }
      ]
    },

    "N5": {
      "text": "SUPPLY KIOSK\n\nYou can spend Credits for Supplies.\n\nThis node tests \"spend + acquire + consume\" loops.",
      "choices": [
        {
          "text": "Buy Medkit (Cost: 6 Credits)",
          "to": "N5",
          "require": { "resourceGte": { "CREDITS": 6 } },
          "effects": [
            { "op": "resourceAdd", "key": "CREDITS", "value": -6 },
            { "op": "giveConsumable", "id": "MEDKIT" }
          ]
        },
        {
          "text": "Buy Bandage (Cost: 3 Credits, +3 HP immediately)",
          "to": "N5",
          "require": { "resourceGte": { "CREDITS": 3 } },
          "effects": [
            { "op": "resourceAdd", "key": "CREDITS", "value": -3 },
            { "op": "resourceAdd", "key": "HP", "value": 3 }
          ]
        },
        {
          "text": "Return to the console",
          "to": "N4"
        },
        {
          "text": "Exit the lab",
          "to": "N7"
        }
      ]
    },

    "N6": {
      "text": "A final hazard triggers as you disconnect the cables.\n\nA feedback arc scorches your sleeve.\n\n(You take 7 damage.)",
      "choices": [
        {
          "text": "Push through",
          "to": "N5",
          "effects": [
            { "op": "resourceAdd", "key": "HP", "value": -7 }
          ]
        },
        {
          "text": "If HP is 0, fail out",
          "to": "END_FAIL",
          "require": { "resourceLte": { "HP": 0 } }
        }
      ]
    },

    "N7": {
      "text": "LAB EXIT\n\nThis is the checkpoint for testing Save/Load integrity.\n\nDo this now:\n1) Open Inventory (verify Vitals, Gear, Supplies).\n2) Save Slot 1.\n3) Refresh the page.\n4) Load Slot 1.\n\nIf items/resources persist correctly, the core loop is solid.",
      "choices": [
        { "text": "Finish (Good End)", "to": "END_GOOD" },
        { "text": "Return to the kiosk", "to": "N5" }
      ]
    },

    "END_FAIL": {
      "text": "FAIL STATE\n\nYour HP hits zero. The lab sim ends.\n\nThis node exists to test resource-based gating and endings.\n\nTry again and spend smarter."
    },

    "END_GOOD": {
      "text": "GOOD END\n\nYou complete the Systems Lab run.\n\nIf this worked, VerseCraft now supports:\n- story-defined resources\n- damage/heal\n- earn/spend\n- consumable use (remove)\n- starting loadout + meaningful equip effects\n- save/load with story sanitation\n\nFoundation approved."
    }
  }
}